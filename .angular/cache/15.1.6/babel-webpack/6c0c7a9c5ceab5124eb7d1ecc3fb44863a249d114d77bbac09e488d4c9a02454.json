{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { BaseInformation } from './base-information';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./base-information.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"primeng/tree\";\nimport * as i5 from \"primeng/contextmenu\";\nfunction BaseInformationEditComponent_div_8_input_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"input\", 18);\n    i0.ɵɵlistener(\"ngModelChange\", function BaseInformationEditComponent_div_8_input_4_Template_input_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.label = $event);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.label);\n  }\n}\nfunction BaseInformationEditComponent_div_8_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"input\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function BaseInformationEditComponent_div_8_ng_template_5_Template_input_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.label = $event);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.label);\n  }\n}\nfunction BaseInformationEditComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"label\");\n    i0.ɵɵtext(2, \"\\u0646\\u0627\\u0645\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵtemplate(4, BaseInformationEditComponent_div_8_input_4_Template, 1, 1, \"input\", 8);\n    i0.ɵɵtemplate(5, BaseInformationEditComponent_div_8_ng_template_5_Template, 1, 1, \"ng-template\", null, 9, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 10)(8, \"span\", 11)(9, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function BaseInformationEditComponent_div_8_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.save());\n    });\n    i0.ɵɵtext(10, \" \\u062B\\u0628\\u062A \");\n    i0.ɵɵelement(11, \"i\", 13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"span\", 11)(13, \"button\", 14);\n    i0.ɵɵtext(14, \" \\u0628\\u0627\\u0632\\u0646\\u0634\\u0627\\u0646\\u06CC \");\n    i0.ɵɵelement(15, \"i\", 15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"span\", 11)(17, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function BaseInformationEditComponent_div_8_Template_button_click_17_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.switchToGrid());\n    });\n    i0.ɵɵtext(18, \" \\u0628\\u0627\\u0632\\u06AF\\u0634\\u062A \");\n    i0.ɵɵelement(19, \"i\", 17);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const _r3 = i0.ɵɵreference(6);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.colorMode)(\"ngIfElse\", _r3);\n  }\n}\n// import {jqxTreeComponent} from \"jqwidgets-ng/jqxtree\";\nexport class BaseInformationEditComponent {\n  ngAfterViewInit() {\n    // setTimeout(() => {\n    //   this.tree.selectItem(null);\n    // });\n  }\n  constructor(baseInformationService, decimalPipe) {\n    this.baseInformationService = baseInformationService;\n    this.decimalPipe = decimalPipe;\n    this.baseInformationTitle = '';\n    this.editMode = false;\n    this.addNode = false;\n    this.colorMode = false;\n    this.baseInformationId = '';\n    this.editModeEmitter = new EventEmitter();\n    this.parent = '';\n    this.label = '';\n    this.treeNode = [];\n    this.selectedFile = null;\n    this.menuItems = [];\n    this.baseInformation = new BaseInformation();\n  }\n  ngOnInit() {\n    this.onLoad();\n    this.menuItems = [{\n      label: 'افزودن',\n      icon: 'pi pi-plus',\n      command: event => this.showAddNode(this.selectedFile, 'add')\n    }, {\n      label: 'ویرایش',\n      icon: 'pi pi-plus',\n      command: event => this.showAddNode(this.selectedFile, 'edit')\n    }\n    // {label: 'Unselect', icon: 'pi pi-times', command: (event) => this.unselectFile()}\n    ];\n  }\n\n  showAddNode(file, mode) {\n    this.colorMode = false;\n    console.log(file);\n    console.log(mode);\n    this.baseInformation = file;\n    let hierarchy;\n    this.parent = this.baseInformation.id;\n    if (mode === 'add') {\n      this.baseInformation.id = '';\n      // @ts-ignore\n      hierarchy = this.baseInformation.hierarchy + this.transformDecimal(this.baseInformation.children.length + 1);\n      if (file.hierarchy == '009') {\n        this.colorMode = true;\n      } else if (file.hierarchy.search('009') != 0 && file.hierarchy <= '009') {\n        this.baseInformation.hierarchy = hierarchy;\n        this.addNode = true;\n      }\n    } else if (mode === 'edit') {\n      if (file.hierarchy.search('009') == 0 && file.hierarchy > '009') {\n        this.colorMode = true;\n      }\n      this.label = this.baseInformation.label;\n      if (this.baseInformation.hierarchy != undefined) {\n        hierarchy = this.baseInformation.hierarchy;\n        this.baseInformation.hierarchy = hierarchy;\n      }\n      this.addNode = true;\n    }\n  }\n  unselectFile() {\n    this.selectedFile = null;\n  }\n  onLoad() {\n    this.baseInformation = new BaseInformation();\n    this.baseInformationService.getAllBaseInformation().subscribe(baseInformations => {\n      this.baseInformations = baseInformations;\n      this.makeTreeJson(this.baseInformations);\n    });\n  }\n  save() {\n    this.baseInformation.label = this.label;\n    this.baseInformation.children = new Array();\n    this.baseInformation.parent = '';\n    this.baseInformationService.saveBaseInformation(this.baseInformation, this.parent).subscribe(data => {\n      this.onLoad();\n      this.addNode = false;\n      this.label = '';\n      this.baseInformation = new BaseInformation();\n    });\n  }\n  switchToGrid() {\n    this.baseInformation = new BaseInformation();\n    this.editModeEmitter.emit(false);\n  }\n  /*selectBaseInformation() {\r\n    this.editMode = true;\r\n    if (this.baseInformationHeader === 'gender') {\r\n      this.baseInformationTitle = 'جنسيت';\r\n    } else if (this.baseInformationHeader === 'wareType') {\r\n      this.baseInformationTitle = 'نوع كالا';\r\n    } else if (this.baseInformationHeader === 'wareUnit') {\r\n      this.baseInformationTitle = 'واحد كالا';\r\n    } else {\r\n      this.editMode = false;\r\n    }\r\n    // this.baseInformationService.getAllBaseInformation().subscribe(baseInformations => {\r\n    //   this.baseInformations = baseInformations;\r\n    //   this.makeTreeJson(baseInformations);\r\n    //   // this.baseInformations = this.removeNull(baseInformations, this.baseInformationHeader);\r\n    // });\r\n  }*/\n  removeNull(objects, type) {\n    objects.forEach((object, index) => {\n      if (object[type] == null) {\n        delete objects[index];\n      } else {}\n    });\n    return objects;\n  }\n  makeTreeJson(baseInformations) {\n    let baseInformationHeaderFiltered = [];\n    baseInformationHeaderFiltered = baseInformations.filter((baseInformation, index) => {\n      baseInformation.hierarchy < 1000 ? delete baseInformations[index] : null;\n      return baseInformation.hierarchy < 1000;\n    });\n    baseInformationHeaderFiltered.forEach(baseInformationHeader => {\n      this.getChild(baseInformationHeader, baseInformations);\n    });\n    this.treeNode = baseInformationHeaderFiltered;\n  }\n  getChild(baseInformationHeader, baseInformations) {\n    let baseInformationsTree = [];\n    baseInformationHeader.children = new Array();\n    baseInformations.filter(baseInformation => {\n      // @ts-ignore\n      if (baseInformation.hierarchy !== baseInformationHeader.hierarchy && baseInformation.hierarchy.search(baseInformationHeader.hierarchy) === 0 && baseInformationHeader.hierarchy.length + 3 === baseInformation.hierarchy.length) {\n        let bae = this.getChild(baseInformation, baseInformations);\n        // @ts-ignore\n        baseInformationHeader.children.push(bae[0]);\n      }\n    });\n    baseInformationsTree.push(baseInformationHeader);\n    return baseInformationsTree;\n  }\n  transformDecimal(num) {\n    return this.decimalPipe.transform(num, '3.');\n  }\n}\nBaseInformationEditComponent.ɵfac = function BaseInformationEditComponent_Factory(t) {\n  return new (t || BaseInformationEditComponent)(i0.ɵɵdirectiveInject(i1.BaseInformationService), i0.ɵɵdirectiveInject(i2.DecimalPipe));\n};\nBaseInformationEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: BaseInformationEditComponent,\n  selectors: [[\"app-base-information-edit\"]],\n  inputs: {\n    baseInformationId: \"baseInformationId\"\n  },\n  outputs: {\n    editModeEmitter: \"editModeEmitter\"\n  },\n  decls: 10,\n  vars: 5,\n  consts: [[1, \"row\", \"m-0\", \"p-0\", \"col-12\", \"col-sm-12\", \"h-100\"], [1, \"col-12\", \"col-sm-12\", \"control-label\", \"text-danger\"], [1, \"row\", \"m-0\", \"mt-3\", \"p-0\", \"col-6\", \"col-sm-6\"], [\"selectionMode\", \"single\", 3, \"value\", \"contextMenu\", \"selection\", \"selectionChange\"], [3, \"model\"], [\"rightMenu\", \"\"], [\"class\", \"row m-0 mt-3 p-0 col-6 col-sm-6\", 4, \"ngIf\"], [1, \"col-6\", \"col-sm-6\"], [\"type\", \"text\", \"class\", \"form-control\", 3, \"ngModel\", \"ngModelChange\", 4, \"ngIf\", \"ngIfElse\"], [\"colorModeFalse\", \"\"], [1, \"row\", \"m-0\", \"mt-3\", \"p-0\", \"col-12\", \"col-sm-12\"], [2, \"width\", \"8rem\"], [1, \"btn\", \"btn-primary\", \"w-100\", 3, \"click\"], [1, \"fa\", \"fa-save\"], [1, \"btn\", \"btn-danger\", \"w-100\"], [1, \"fa\", \"fa-refresh\"], [1, \"btn\", \"btn-warning\", \"w-100\", 3, \"click\"], [1, \"fa\", \"fa-backspace\"], [\"type\", \"text\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"color\", 3, \"ngModel\", \"ngModelChange\"]],\n  template: function BaseInformationEditComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"label\", 1);\n      i0.ɵɵtext(2, \"\\u0627\\u0637\\u0644\\u0627\\u0639\\u0627\\u062A \\u0627\\u0648\\u0644\\u064A\\u0647\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\")(5, \"p-tree\", 3);\n      i0.ɵɵlistener(\"selectionChange\", function BaseInformationEditComponent_Template_p_tree_selectionChange_5_listener($event) {\n        return ctx.selectedFile = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(6, \"p-contextMenu\", 4, 5);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(8, BaseInformationEditComponent_div_8_Template, 20, 2, \"div\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(9, \"\\n\\u00A0\\n\");\n    }\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(7);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"value\", ctx.treeNode)(\"contextMenu\", _r0)(\"selection\", ctx.selectedFile);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"model\", ctx.menuItems);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.addNode);\n    }\n  },\n  dependencies: [i2.NgIf, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i4.Tree, i5.ContextMenu],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["EventEmitter","BaseInformation","i0","BaseInformationEditComponent","ngAfterViewInit","constructor","baseInformationService","decimalPipe","baseInformation","ngOnInit","onLoad","menuItems","label","icon","command","event","showAddNode","selectedFile","file","mode","colorMode","console","log","hierarchy","parent","id","transformDecimal","children","length","search","addNode","undefined","unselectFile","getAllBaseInformation","subscribe","baseInformations","makeTreeJson","save","Array","saveBaseInformation","data","switchToGrid","editModeEmitter","emit","removeNull","objects","type","forEach","object","index","baseInformationHeaderFiltered","filter","baseInformationHeader","getChild","treeNode","baseInformationsTree","bae","push","num","transform","selectors","inputs","baseInformationId","outputs","decls","vars","consts","template"],"sourceRoot":"","sources":["D:\\wamp64\\www\\warehouseMicroService\\warehouseUi0\\src\\app\\general\\reference\\base-information\\base-information-edit.component.ts","D:\\wamp64\\www\\warehouseMicroService\\warehouseUi0\\src\\app\\general\\reference\\base-information\\base-information-edit.component.html"],"sourcesContent":["import {AfterViewInit, Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\r\nimport {BaseInformation} from './base-information';\r\nimport {BaseInformationService} from './base-information.service';\r\nimport {MenuItem, TreeNode} from \"primeng/api\";\r\nimport {DecimalPipe} from \"@angular/common\";\r\n\r\n// import {jqxTreeComponent} from \"jqwidgets-ng/jqxtree\";\r\n\r\n@Component({\r\n  selector: 'app-base-information-edit',\r\n  templateUrl: './base-information-edit.component.html',\r\n  styleUrls: ['./base-information-edit.component.css']\r\n})\r\nexport class BaseInformationEditComponent implements OnInit, AfterViewInit {\r\n\r\n  public baseInformation: BaseInformation;\r\n  public baseInformations?: BaseInformation[];\r\n  // public iBaseInformations?: IBaseInformation;\r\n  public editLoadId?: string;\r\n  public baseInformationTitle = '';\r\n  public editMode = false;\r\n  public addNode = false;\r\n  public colorMode = false;\r\n  @Input() public baseInformationId = '';\r\n  @Output() public editModeEmitter: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n  baseInformationHeader!: string;\r\n  plusMode: any;\r\n  parent = '';\r\n  label?= '';\r\n\r\n  treeNode: TreeNode[] = [];\r\n  selectedFile: TreeNode | null = null;\r\n  menuItems: MenuItem[] = [];\r\n\r\n  ngAfterViewInit(): void {\r\n    // setTimeout(() => {\r\n    //   this.tree.selectItem(null);\r\n    // });\r\n  }\r\n\r\n  constructor(\r\n    private baseInformationService: BaseInformationService,\r\n    private decimalPipe: DecimalPipe,\r\n  ) {\r\n    this.baseInformation = new BaseInformation();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.onLoad();\r\n    this.menuItems = [\r\n      {label: 'افزودن', icon: 'pi pi-plus', command: (event) => this.showAddNode(this.selectedFile, 'add')},\r\n      {label: 'ویرایش', icon: 'pi pi-plus', command: (event) => this.showAddNode(this.selectedFile, 'edit')}\r\n      // {label: 'Unselect', icon: 'pi pi-times', command: (event) => this.unselectFile()}\r\n    ];\r\n  }\r\n\r\n  showAddNode(file: any, mode: string) {\r\n    this.colorMode = false;\r\n    console.log(file);\r\n    console.log(mode);\r\n    this.baseInformation = file as BaseInformation;\r\n    let hierarchy: string;\r\n    this.parent = this.baseInformation.id as string;\r\n    if (mode === 'add') {\r\n      this.baseInformation.id = '';\r\n      // @ts-ignore\r\n      hierarchy = this.baseInformation.hierarchy + this.transformDecimal(this.baseInformation.children.length + 1);\r\n      if (file.hierarchy == '009') {\r\n        this.colorMode = true;\r\n      } else if (file.hierarchy.search('009') != 0 && file.hierarchy <= '009') {\r\n        this.baseInformation.hierarchy = hierarchy;\r\n        this.addNode = true;\r\n      }\r\n    } else if (mode === 'edit') {\r\n      if (file.hierarchy.search('009') == 0 && file.hierarchy > '009') {\r\n        this.colorMode = true;\r\n      }\r\n      this.label = this.baseInformation.label;\r\n      if (this.baseInformation.hierarchy != undefined) {\r\n      hierarchy = this.baseInformation.hierarchy;\r\n      this.baseInformation.hierarchy = hierarchy;\r\n      }\r\n      this.addNode = true;\r\n    }\r\n  }\r\n\r\n  unselectFile() {\r\n    this.selectedFile = null;\r\n  }\r\n\r\n  onLoad() {\r\n    this.baseInformation = new BaseInformation();\r\n    this.baseInformationService.getAllBaseInformation().subscribe(baseInformations => {\r\n      this.baseInformations = baseInformations;\r\n      this.makeTreeJson(this.baseInformations);\r\n    });\r\n  }\r\n\r\n  save() {\r\n    this.baseInformation.label = this.label;\r\n    this.baseInformation.children = new Array<BaseInformation>();\r\n    this.baseInformation.parent = '';\r\n    this.baseInformationService.saveBaseInformation(this.baseInformation, this.parent).subscribe(\r\n      data => {\r\n        this.onLoad();\r\n        this.addNode = false;\r\n        this.label = '';\r\n        this.baseInformation = new BaseInformation();\r\n      }\r\n    );\r\n  }\r\n\r\n  switchToGrid() {\r\n    this.baseInformation = new BaseInformation();\r\n    this.editModeEmitter.emit(false);\r\n  }\r\n\r\n  /*selectBaseInformation() {\r\n    this.editMode = true;\r\n    if (this.baseInformationHeader === 'gender') {\r\n      this.baseInformationTitle = 'جنسيت';\r\n    } else if (this.baseInformationHeader === 'wareType') {\r\n      this.baseInformationTitle = 'نوع كالا';\r\n    } else if (this.baseInformationHeader === 'wareUnit') {\r\n      this.baseInformationTitle = 'واحد كالا';\r\n    } else {\r\n      this.editMode = false;\r\n    }\r\n    // this.baseInformationService.getAllBaseInformation().subscribe(baseInformations => {\r\n    //   this.baseInformations = baseInformations;\r\n    //   this.makeTreeJson(baseInformations);\r\n    //   // this.baseInformations = this.removeNull(baseInformations, this.baseInformationHeader);\r\n    // });\r\n  }*/\r\n\r\n  removeNull(objects: any, type: any) {\r\n    objects.forEach((object: { [x: string]: null; }, index: number) => {\r\n      if (object[type] == null) {\r\n        delete objects[index];\r\n      } else {\r\n      }\r\n    });\r\n    return objects;\r\n  }\r\n\r\n  public makeTreeJson(baseInformations: any[]): void {\r\n    let baseInformationHeaderFiltered: BaseInformation[] = [];\r\n    baseInformationHeaderFiltered = baseInformations.filter((baseInformation, index) => {\r\n      baseInformation.hierarchy < 1000 ? delete baseInformations[index] : null;\r\n      return baseInformation.hierarchy < 1000;\r\n    });\r\n    baseInformationHeaderFiltered.forEach((baseInformationHeader) => {\r\n      this.getChild(baseInformationHeader, baseInformations);\r\n    });\r\n    this.treeNode = baseInformationHeaderFiltered as TreeNode[];\r\n  }\r\n\r\n  getChild(baseInformationHeader: BaseInformation, baseInformations: BaseInformation[]): BaseInformation[] {\r\n    let baseInformationsTree: BaseInformation[] = [];\r\n    baseInformationHeader.children = new Array<BaseInformation>();\r\n    baseInformations.filter(baseInformation => {\r\n      // @ts-ignore\r\n      if (baseInformation.hierarchy !== baseInformationHeader.hierarchy && baseInformation.hierarchy.search(baseInformationHeader.hierarchy) === 0 && (baseInformationHeader.hierarchy.length + 3) === baseInformation.hierarchy.length) {\r\n        let bae = this.getChild(baseInformation, baseInformations);\r\n        // @ts-ignore\r\n        baseInformationHeader.children.push(bae[0] as BaseInformation);\r\n      }\r\n    });\r\n    baseInformationsTree.push(baseInformationHeader);\r\n    return baseInformationsTree;\r\n  }\r\n\r\n  transformDecimal(num: number) {\r\n    return this.decimalPipe.transform(num, '3.');\r\n  }\r\n}\r\n","<div class=\"row m-0 p-0 col-12 col-sm-12 h-100\">\r\n  <label class=\"col-12 col-sm-12 control-label text-danger\">اطلاعات اوليه</label>\r\n  <div class=\"row m-0 mt-3 p-0 col-6 col-sm-6\">\r\n    <div>\r\n      <p-tree\r\n        [value]=\"treeNode\"\r\n        [contextMenu]=\"rightMenu\"\r\n        selectionMode=\"single\"\r\n        [(selection)]=\"selectedFile\"\r\n      ></p-tree>\r\n      <p-contextMenu #rightMenu [model]=\"menuItems\"></p-contextMenu>\r\n      <!--      <p-toast></p-toast>-->\r\n    </div>\r\n  </div>\r\n  <div class=\"row m-0 mt-3 p-0 col-6 col-sm-6\" *ngIf=\"addNode\">\r\n    <label>نام</label>\r\n    <div class=\"col-6 col-sm-6\">\r\n      <input *ngIf=\"!colorMode; else colorModeFalse\" type=\"text\" class=\"form-control\" [(ngModel)]=\"label\">\r\n      <ng-template #colorModeFalse>\r\n        <input type=\"color\" [(ngModel)]=\"label\">\r\n      </ng-template>\r\n    </div>\r\n    <div class=\"row m-0 mt-3 p-0 col-12 col-sm-12\">\r\n    <span style=\"width: 8rem;\">\r\n    <button class=\"btn btn-primary w-100\" (click)=\"save()\">\r\n      ثبت\r\n      <i class=\"fa fa-save\"></i>\r\n    </button>\r\n    </span>\r\n      <span style=\"width: 8rem;\">\r\n    <button class=\"btn btn-danger w-100\">\r\n      بازنشانی\r\n      <i class=\"fa fa-refresh\"></i>\r\n    </button>\r\n    </span>\r\n      <span style=\"width: 8rem;\">\r\n    <button class=\"btn btn-warning w-100\" (click)=\"switchToGrid()\">\r\n      بازگشت\r\n      <i class=\"fa fa-backspace\"></i>\r\n    </button>\r\n    </span>\r\n    </div>\r\n  </div>\r\n</div>\r\n&nbsp;\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}